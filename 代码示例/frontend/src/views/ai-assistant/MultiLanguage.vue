<template>
  <div class="multi-language-page">
    <!-- é¡µé¢æ ‡é¢˜ -->
    <div class="page-header">
      <h1>å¤šè¯­è¨€å†…å®¹ç”Ÿæˆ</h1>
      <p class="page-desc">ä½¿ç”¨AIæŠ€æœ¯ç”Ÿæˆå¤šè¯­è¨€è¥é”€å†…å®¹ï¼Œæ”¯æŒæœ¬åœ°åŒ–è°ƒæ•´å’Œæœ¯è¯­åº“ç®¡ç†</p>
    </div>

    <el-row :gutter="24">
      <!-- é…ç½®é¢æ¿ -->
      <el-col :span="8">
        <el-card class="config-panel">
          <template #header>
            <div class="card-header">
              <span>ç”Ÿæˆé…ç½®</span>
              <el-tooltip content="é…ç½®å¤šè¯­è¨€å†…å®¹ç”Ÿæˆå‚æ•°">
                <el-icon><InfoFilled /></el-icon>
              </el-tooltip>
            </div>
          </template>

          <el-form :model="formData" label-width="120px" size="default">
            <!-- æºè¯­è¨€ -->
            <el-form-item label="æºè¯­è¨€">
              <el-select v-model="formData.sourceLanguage" style="width: 100%">
                <el-option-group label="å¸¸ç”¨è¯­è¨€">
                  <el-option label="ä¸­æ–‡ (ç®€ä½“)" value="zh-CN" />
                  <el-option label="è‹±è¯­" value="en" />
                  <el-option label="æ—¥è¯­" value="ja" />
                  <el-option label="éŸ©è¯­" value="ko" />
                </el-option-group>
                <el-option-group label="æ¬§æ´²è¯­è¨€">
                  <el-option label="å¾·è¯­" value="de" />
                  <el-option label="æ³•è¯­" value="fr" />
                  <el-option label="è¥¿ç­ç‰™è¯­" value="es" />
                  <el-option label="æ„å¤§åˆ©è¯­" value="it" />
                  <el-option label="ä¿„è¯­" value="ru" />
                </el-option-group>
              </el-select>
            </el-form-item>

            <!-- ç›®æ ‡è¯­è¨€ -->
            <el-form-item label="ç›®æ ‡è¯­è¨€">
              <div class="language-selection">
                <el-checkbox-group v-model="formData.targetLanguages">
                  <div class="language-grid">
                    <el-checkbox label="en" class="language-item">
                      <div class="language-content">
                        <span class="flag">ğŸ‡ºğŸ‡¸</span>
                        <span>English</span>
                      </div>
                    </el-checkbox>
                    <el-checkbox label="ja" class="language-item">
                      <div class="language-content">
                        <span class="flag">ğŸ‡¯ğŸ‡µ</span>
                        <span>æ—¥æœ¬èª</span>
                      </div>
                    </el-checkbox>
                    <el-checkbox label="ko" class="language-item">
                      <div class="language-content">
                        <span class="flag">ğŸ‡°ğŸ‡·</span>
                        <span>í•œêµ­ì–´</span>
                      </div>
                    </el-checkbox>
                    <el-checkbox label="de" class="language-item">
                      <div class="language-content">
                        <span class="flag">ğŸ‡©ğŸ‡ª</span>
                        <span>Deutsch</span>
                      </div>
                    </el-checkbox>
                    <el-checkbox label="fr" class="language-item">
                      <div class="language-content">
                        <span class="flag">ğŸ‡«ğŸ‡·</span>
                        <span>FranÃ§ais</span>
                      </div>
                    </el-checkbox>
                    <el-checkbox label="es" class="language-item">
                      <div class="language-content">
                        <span class="flag">ğŸ‡ªğŸ‡¸</span>
                        <span>EspaÃ±ol</span>
                      </div>
                    </el-checkbox>
                    <el-checkbox label="it" class="language-item">
                      <div class="language-content">
                        <span class="flag">ğŸ‡®ğŸ‡¹</span>
                        <span>Italiano</span>
                      </div>
                    </el-checkbox>
                    <el-checkbox label="ru" class="language-item">
                      <div class="language-content">
                        <span class="flag">ğŸ‡·ğŸ‡º</span>
                        <span>Ğ ÑƒÑÑĞºĞ¸Ğ¹</span>
                      </div>
                    </el-checkbox>
                  </div>
                </el-checkbox-group>
              </div>
            </el-form-item>

            <!-- æºå†…å®¹ -->
            <el-form-item label="æºå†…å®¹">
              <el-input 
                v-model="formData.sourceContent" 
                type="textarea"
                :rows="6"
                placeholder="è¯·è¾“å…¥è¦ç¿»è¯‘å’Œæœ¬åœ°åŒ–çš„åŸå§‹å†…å®¹"
                maxlength="2000"
                show-word-limit
              />
            </el-form-item>

            <!-- å†…å®¹ç±»å‹ -->
            <el-form-item label="å†…å®¹ç±»å‹">
              <el-select v-model="formData.contentType" placeholder="è¯·é€‰æ‹©å†…å®¹ç±»å‹" style="width: 100%">
                <el-option label="äº§å“æè¿°" value="product-description" />
                <el-option label="è¥é”€æ–‡æ¡ˆ" value="marketing-copy" />
                <el-option label="å¹¿å‘Šæ ‡è¯­" value="advertisement" />
                <el-option label="é‚®ä»¶å†…å®¹" value="email-content" />
                <el-option label="ç½‘ç«™å†…å®¹" value="website-content" />
                <el-option label="ç¤¾åª’å†…å®¹" value="social-media" />
                <el-option label="æ–°é—»ç¨¿" value="press-release" />
                <el-option label="æŠ€æœ¯æ–‡æ¡£" value="technical-docs" />
              </el-select>
            </el-form-item>

            <!-- ç›®æ ‡å¸‚åœº -->
            <el-form-item label="ç›®æ ‡å¸‚åœº">
              <el-select v-model="formData.targetMarket" multiple placeholder="é€‰æ‹©ç›®æ ‡å¸‚åœº" style="width: 100%">
                <el-option label="åŒ—ç¾å¸‚åœº" value="north-america" />
                <el-option label="æ¬§æ´²å¸‚åœº" value="europe" />
                <el-option label="äºšæ´²å¸‚åœº" value="asia" />
                <el-option label="æ—¥æœ¬å¸‚åœº" value="japan" />
                <el-option label="éŸ©å›½å¸‚åœº" value="korea" />
                <el-option label="ä¸œå—äºšå¸‚åœº" value="southeast-asia" />
                <el-option label="å—ç¾å¸‚åœº" value="south-america" />
                <el-option label="ä¸­ä¸œå¸‚åœº" value="middle-east" />
              </el-select>
            </el-form-item>

            <!-- æœ¬åœ°åŒ–çº§åˆ« -->
            <el-form-item label="æœ¬åœ°åŒ–çº§åˆ«">
              <el-radio-group v-model="formData.localizationLevel">
                <el-radio label="basic">åŸºç¡€ç¿»è¯‘</el-radio>
                <el-radio label="standard">æ ‡å‡†æœ¬åœ°åŒ–</el-radio>
                <el-radio label="advanced">æ·±åº¦æœ¬åœ°åŒ–</el-radio>
              </el-radio-group>
              <div class="localization-hint">
                <p v-if="formData.localizationLevel === 'basic'">åªè¿›è¡Œè¯­è¨€ç¿»è¯‘</p>
                <p v-if="formData.localizationLevel === 'standard'">ç¿»è¯‘ + æ–‡åŒ–é€‚é…</p>
                <p v-if="formData.localizationLevel === 'advanced'">ç¿»è¯‘ + æ–‡åŒ–é€‚é… + å¸‚åœºä¹ æƒ¯è°ƒæ•´</p>
              </div>
            </el-form-item>

            <!-- è¯­æ°”è°ƒæ•´ -->
            <el-form-item label="è¯­æ°”è°ƒæ•´">
              <el-checkbox-group v-model="formData.toneAdjustments">
                <el-checkbox label="formal">æ­£å¼åŒ–</el-checkbox>
                <el-checkbox label="casual">å£è¯­åŒ–</el-checkbox>
                <el-checkbox label="respectful">ç¤¼è²Œæ€§</el-checkbox>
                <el-checkbox label="persuasive">è¯´æœæ€§</el-checkbox>
                <el-checkbox label="emotional">æƒ…æ„ŸåŒ–</el-checkbox>
              </el-checkbox-group>
            </el-form-item>

            <!-- æœ¯è¯­åº“åº”ç”¨ -->
            <el-form-item label="æœ¯è¯­åº“">
              <el-switch 
                v-model="formData.useGlossary"
                active-text="ä½¿ç”¨æœ¯è¯­åº“"
                inactive-text="ä¸ä½¿ç”¨"
              />
              <div v-if="formData.useGlossary" class="glossary-selection">
                <el-select v-model="formData.selectedGlossary" placeholder="é€‰æ‹©æœ¯è¯­åº“" style="width: 100%; margin-top: 8px;">
                  <el-option label="é€šç”¨è¥é”€æœ¯è¯­" value="marketing-general" />
                  <el-option label="ç§‘æŠ€äº§å“æœ¯è¯­" value="tech-products" />
                  <el-option label="é‡‘èæœåŠ¡æœ¯è¯­" value="financial-services" />
                  <el-option label="åŒ»ç–—å¥åº·æœ¯è¯­" value="healthcare" />
                  <el-option label="æ•™è‚²åŸ¹è®­æœ¯è¯­" value="education" />
                </el-select>
                <el-button 
                  @click="showGlossaryManager = true" 
                  size="small" 
                  text 
                  style="margin-top: 8px;"
                >
                  ç®¡ç†æœ¯è¯­åº“
                </el-button>
              </div>
            </el-form-item>

            <!-- AIæ¨¡å‹é€‰æ‹© -->
            <el-form-item label="AIæ¨¡å‹">
              <el-select v-model="formData.aiModel" style="width: 100%">
                <el-option label="GPT-4 (æ¨è)" value="gpt-4" />
                <el-option label="Claude-3" value="claude-3" />
                <el-option label="è°·æ­Œç¿»è¯‘å¢å¼º" value="google-translate-plus" />
                <el-option label="DeepLä¸“ä¸šç‰ˆ" value="deepl-pro" />
              </el-select>
            </el-form-item>

            <!-- ç”ŸæˆæŒ‰é’® -->
            <el-form-item>
              <el-button 
                type="primary" 
                :loading="generating" 
                @click="generateTranslations"
                :disabled="!canGenerate"
                style="width: 100%"
                size="large"
              >
                <el-icon v-if="!generating"><MagicStick /></el-icon>
                {{ generating ? 'ç”Ÿæˆä¸­...' : 'ç”Ÿæˆå¤šè¯­è¨€å†…å®¹' }}
              </el-button>
            </el-form-item>

            <!-- ä½¿ç”¨ç»Ÿè®¡ -->
            <div class="usage-stats">
              <el-divider>ä»Šæ—¥ä½¿ç”¨é‡</el-divider>
              <div class="stats-item">
                <span>å·²ç¿»è¯‘ï¼š</span>
                <el-tag type="success">{{ dailyUsage }}/200</el-tag>
              </div>
              <el-progress 
                :percentage="Math.round((dailyUsage / 200) * 100)" 
                :color="progressColor"
                :stroke-width="8"
              />
            </div>
          </el-form>
        </el-card>
      </el-col>

      <!-- ç»“æœå±•ç¤ºé¢æ¿ -->
      <el-col :span="16">
        <el-card class="results-panel">
          <template #header>
            <div class="card-header">
              <span>ç¿»è¯‘ç»“æœ</span>
              <div class="header-actions" v-if="translations.length > 0">
                <el-button @click="compareMode = !compareMode" size="small">
                  {{ compareMode ? 'åˆ—è¡¨è§†å›¾' : 'å¯¹æ¯”è§†å›¾' }}
                </el-button>
                <el-button @click="exportTranslations" size="small" :icon="Download">
                  å¯¼å‡º
                </el-button>
              </div>
            </div>
          </template>

          <!-- åŠ è½½çŠ¶æ€ -->
          <div v-if="generating" class="loading-container">
            <el-skeleton :rows="8" animated />
            <div class="loading-text">
              <el-icon class="rotating"><Loading /></el-icon>
              æ­£åœ¨ç”Ÿæˆ{{ formData.targetLanguages.length }}ç§è¯­è¨€ç‰ˆæœ¬ï¼Œè¯·ç¨å€™...
            </div>
            <el-progress :percentage="generateProgress" :stroke-width="8" />
          </div>

          <!-- å¯¹æ¯”è§†å›¾ -->
          <div v-else-if="translations.length > 0 && compareMode" class="compare-view">
            <div class="source-content">
              <h3>åŸæ–‡ ({{ getLanguageLabel(formData.sourceLanguage) }})</h3>
              <div class="content-box source">{{ formData.sourceContent }}</div>
            </div>
            
            <div class="translations-grid">
              <div 
                v-for="translation in translations" 
                :key="translation.language"
                class="translation-item"
              >
                <div class="translation-header">
                  <span class="language-name">
                    {{ getLanguageFlag(translation.language) }} {{ getLanguageLabel(translation.language) }}
                  </span>
                  <div class="translation-actions">
                    <el-rate 
                      v-model="translation.rating" 
                      size="small"
                      @change="updateRating(translation.language, $event)"
                    />
                  </div>
                </div>
                
                <div class="content-box translation">
                  <div class="translation-content">{{ translation.content }}</div>
                  <div class="translation-meta">
                    <el-tag size="small">{{ translation.content.length }}å­—ç¬¦</el-tag>
                    <el-tag size="small" :type="getQualityType(translation.quality)">
                      è´¨é‡: {{ translation.quality }}%
                    </el-tag>
                  </div>
                </div>
                
                <div class="translation-tools">
                  <el-button-group size="small">
                    <el-button @click="copyTranslation(translation.content)" :icon="DocumentCopy">
                      å¤åˆ¶
                    </el-button>
                    <el-button @click="editTranslation(translation)" :icon="Edit">
                      ç¼–è¾‘
                    </el-button>
                    <el-button @click="regenerateTranslation(translation.language)" :icon="Refresh">
                      é‡æ–°ç”Ÿæˆ
                    </el-button>
                  </el-button-group>
                </div>
              </div>
            </div>
          </div>

          <!-- åˆ—è¡¨è§†å›¾ -->
          <div v-else-if="translations.length > 0" class="list-view">
            <el-tabs v-model="activeLanguage" type="border-card">
              <el-tab-pane 
                v-for="translation in translations" 
                :key="translation.language"
                :name="translation.language"
              >
                <template #label>
                  <span>
                    {{ getLanguageFlag(translation.language) }} {{ getLanguageLabel(translation.language) }}
                  </span>
                </template>
                
                <div class="translation-detail">
                  <!-- ç¿»è¯‘ç»Ÿè®¡ -->
                  <div class="translation-stats">
                    <el-row :gutter="16">
                      <el-col :span="6">
                        <el-statistic title="å­—ç¬¦æ•°" :value="translation.content.length" />
                      </el-col>
                      <el-col :span="6">
                        <el-statistic title="ç¿»è¯‘è´¨é‡" :value="translation.quality" suffix="%" />
                      </el-col>
                      <el-col :span="6">
                        <el-statistic title="æœ¬åœ°åŒ–ç¨‹åº¦" :value="translation.localization" suffix="%" />
                      </el-col>
                      <el-col :span="6">
                        <div class="rating-section">
                          <span class="rating-label">ç”¨æˆ·è¯„åˆ†ï¼š</span>
                          <el-rate 
                            v-model="translation.rating" 
                            @change="updateRating(translation.language, $event)"
                          />
                        </div>
                      </el-col>
                    </el-row>
                  </div>

                  <!-- ç¿»è¯‘å†…å®¹ -->
                  <div class="translation-content-section">
                    <h4>ç¿»è¯‘å†…å®¹</h4>
                    <div class="content-display">
                      <el-input 
                        v-model="translation.content"
                        type="textarea"
                        :rows="8"
                        readonly
                        class="translation-textarea"
                      />
                    </div>
                  </div>

                  <!-- æœ¬åœ°åŒ–å»ºè®® -->
                  <div v-if="translation.suggestions && translation.suggestions.length > 0" class="suggestions-section">
                    <h4>æœ¬åœ°åŒ–å»ºè®®</h4>
                    <el-alert 
                      v-for="(suggestion, index) in translation.suggestions" 
                      :key="index"
                      :title="suggestion.title"
                      :description="suggestion.description"
                      type="info"
                      show-icon
                      class="suggestion-item"
                    />
                  </div>

                  <!-- å…³é”®è¯å¯¹ç…§ -->
                  <div v-if="translation.keywords && translation.keywords.length > 0" class="keywords-section">
                    <h4>å…³é”®è¯å¯¹ç…§</h4>
                    <el-table :data="translation.keywords" size="small">
                      <el-table-column prop="source" label="åŸæ–‡" width="200" />
                      <el-table-column prop="target" label="è¯‘æ–‡" width="200" />
                      <el-table-column prop="note" label="æ³¨é‡Š" />
                    </el-table>
                  </div>

                  <!-- æ“ä½œæŒ‰é’® -->
                  <div class="translation-actions-full">
                    <el-button-group>
                      <el-button @click="copyTranslation(translation.content)" :icon="DocumentCopy">
                        å¤åˆ¶ç¿»è¯‘
                      </el-button>
                      <el-button @click="editTranslation(translation)" :icon="Edit">
                        ç¼–è¾‘å†…å®¹
                      </el-button>
                      <el-button @click="regenerateTranslation(translation.language)" :icon="Refresh">
                        é‡æ–°ç¿»è¯‘
                      </el-button>
                      <el-button @click="saveToLibrary(translation)" :icon="Collection">
                        ä¿å­˜åˆ°åº“
                      </el-button>
                      <el-button @click="applyTranslation(translation)" :icon="Check" type="primary">
                        åº”ç”¨ç¿»è¯‘
                      </el-button>
                    </el-button-group>
                  </div>
                </div>
              </el-tab-pane>
            </el-tabs>
          </div>

          <!-- ç©ºçŠ¶æ€ -->
          <div v-else class="empty-state">
            <el-empty description="è¯·é…ç½®å‚æ•°å¹¶ç‚¹å‡»ç”ŸæˆæŒ‰é’®">
              <el-icon class="empty-icon"><ChatLineRound /></el-icon>
              <p>è¾“å…¥æºå†…å®¹ï¼ŒAIå°†ä¸ºæ‚¨ç”Ÿæˆå¤šè¯­è¨€ç‰ˆæœ¬</p>
            </el-empty>
          </div>
        </el-card>
      </el-col>
    </el-row>

    <!-- æœ¯è¯­åº“ç®¡ç†å¯¹è¯æ¡† -->
    <el-dialog 
      v-model="showGlossaryManager"
      title="æœ¯è¯­åº“ç®¡ç†"
      width="80%"
      destroy-on-close
    >
      <div class="glossary-manager">
        <div class="glossary-header">
          <el-button @click="addGlossaryTerm" type="primary" :icon="Plus">
            æ·»åŠ æœ¯è¯­
          </el-button>
        </div>
        
        <el-table :data="glossaryTerms" height="400">
          <el-table-column prop="source" label="æºè¯­è¨€" width="200" />
          <el-table-column prop="target" label="ç›®æ ‡è¯­è¨€" width="200" />
          <el-table-column prop="category" label="åˆ†ç±»" width="120" />
          <el-table-column prop="note" label="å¤‡æ³¨" />
          <el-table-column label="æ“ä½œ" width="150">
            <template #default="scope">
              <el-button size="small" @click="editGlossaryTerm(scope.row)">ç¼–è¾‘</el-button>
              <el-button size="small" type="danger" @click="deleteGlossaryTerm(scope.$index)">åˆ é™¤</el-button>
            </template>
          </el-table-column>
        </el-table>
      </div>
    </el-dialog>

    <!-- ç¼–è¾‘å¯¹è¯æ¡† -->
    <el-dialog 
      v-model="editDialogVisible"
      title="ç¼–è¾‘ç¿»è¯‘å†…å®¹"
      width="70%"
      destroy-on-close
    >
      <el-form :model="editForm" label-width="100px">
        <el-form-item label="è¯­è¨€">
          <el-tag>{{ getLanguageLabel(editForm.language) }}</el-tag>
        </el-form-item>
        <el-form-item label="å†…å®¹">
          <el-input 
            v-model="editForm.content"
            type="textarea"
            :rows="10"
            show-word-limit
          />
        </el-form-item>
      </el-form>
      
      <template #footer>
        <span class="dialog-footer">
          <el-button @click="editDialogVisible = false">å–æ¶ˆ</el-button>
          <el-button type="primary" @click="saveTranslationEdit">ä¿å­˜</el-button>
        </span>
      </template>
    </el-dialog>
  </div>
</template>

<script setup>
import { ref, reactive, computed, watch } from 'vue'
import { ElMessage, ElMessageBox } from 'element-plus'
import {
  InfoFilled, MagicStick, Loading, DocumentCopy, Download, Edit, Refresh,
  ChatLineRound, Check, Collection, Plus
} from '@element-plus/icons-vue'

// è¡¨å•æ•°æ®
const formData = reactive({
  sourceLanguage: 'zh-CN',
  targetLanguages: [],
  sourceContent: '',
  contentType: '',
  targetMarket: [],
  localizationLevel: 'standard',
  toneAdjustments: ['respectful'],
  useGlossary: false,
  selectedGlossary: '',
  aiModel: 'gpt-4'
})

// ç”ŸæˆçŠ¶æ€
const generating = ref(false)
const generateProgress = ref(0)
const dailyUsage = ref(36)
const compareMode = ref(false)
const activeLanguage = ref('')
const translations = ref([])

// å¯¹è¯æ¡†çŠ¶æ€
const showGlossaryManager = ref(false)
const editDialogVisible = ref(false)
const editForm = reactive({
  language: '',
  content: ''
})

// æœ¯è¯­åº“æ•°æ®
const glossaryTerms = ref([
  { source: 'äº§å“', target: 'Product', category: 'è¥é”€', note: 'é€šç”¨äº§å“æœ¯è¯­' },
  { source: 'æœåŠ¡', target: 'Service', category: 'è¥é”€', note: 'æœåŠ¡ç±»æœ¯è¯­' },
  { source: 'ä¼˜æƒ ', target: 'Discount', category: 'è¥é”€', note: 'ä¿ƒé”€ç›¸å…³' }
])

// è®¡ç®—å±æ€§
const canGenerate = computed(() => {
  return formData.sourceContent.trim() && 
         formData.targetLanguages.length > 0 && 
         dailyUsage.value < 200
})

const progressColor = computed(() => {
  const percentage = (dailyUsage.value / 200) * 100
  if (percentage < 50) return '#67c23a'
  if (percentage < 80) return '#e6a23c'
  return '#f56c6c'
})

// ç›‘å¬ç›®æ ‡è¯­è¨€å˜åŒ–
watch(() => formData.targetLanguages, (newLanguages) => {
  if (newLanguages.length > 0 && !activeLanguage.value) {
    activeLanguage.value = newLanguages[0]
  }
}, { immediate: true })

// è¯­è¨€æ ‡ç­¾æ˜ å°„
const languageLabels = {
  'zh-CN': 'ä¸­æ–‡(ç®€ä½“)',
  'en': 'English',
  'ja': 'æ—¥æœ¬èª',
  'ko': 'í•œêµ­ì–´',
  'de': 'Deutsch',
  'fr': 'FranÃ§ais',
  'es': 'EspaÃ±ol',
  'it': 'Italiano',
  'ru': 'Ğ ÑƒÑÑĞºĞ¸Ğ¹'
}

// è¯­è¨€æ——å¸œæ˜ å°„
const languageFlags = {
  'zh-CN': 'ğŸ‡¨ğŸ‡³',
  'en': 'ğŸ‡ºğŸ‡¸',
  'ja': 'ğŸ‡¯ğŸ‡µ',
  'ko': 'ğŸ‡°ğŸ‡·',
  'de': 'ğŸ‡©ğŸ‡ª',
  'fr': 'ğŸ‡«ğŸ‡·',
  'es': 'ğŸ‡ªğŸ‡¸',
  'it': 'ğŸ‡®ğŸ‡¹',
  'ru': 'ğŸ‡·ğŸ‡º'
}

// è·å–è¯­è¨€æ ‡ç­¾
const getLanguageLabel = (language) => {
  return languageLabels[language] || language
}

// è·å–è¯­è¨€æ——å¸œ
const getLanguageFlag = (language) => {
  return languageFlags[language] || 'ğŸŒ'
}

// è·å–è´¨é‡ç±»å‹
const getQualityType = (quality) => {
  if (quality >= 90) return 'success'
  if (quality >= 75) return 'warning'
  return 'danger'
}

// ç”Ÿæˆç¿»è¯‘
const generateTranslations = async () => {
  if (!canGenerate.value) {
    ElMessage.warning('è¯·å®Œå–„å¿…å¡«å‚æ•°æˆ–æ£€æŸ¥ä»Šæ—¥ä½¿ç”¨é‡')
    return
  }

  generating.value = true
  generateProgress.value = 0
  
  try {
    const results = []
    
    // ä¸ºæ¯ç§ç›®æ ‡è¯­è¨€ç”Ÿæˆç¿»è¯‘
    for (let i = 0; i < formData.targetLanguages.length; i++) {
      const language = formData.targetLanguages[i]
      
      generateProgress.value = Math.round(((i + 1) / formData.targetLanguages.length) * 100)
      
      // æ¨¡æ‹ŸAIç¿»è¯‘è¿‡ç¨‹
      await new Promise(resolve => setTimeout(resolve, 1500))
      
      const translation = await generateTranslation(language)
      results.push(translation)
    }
    
    translations.value = results
    activeLanguage.value = formData.targetLanguages[0]
    dailyUsage.value += formData.targetLanguages.length
    
    ElMessage.success(`æˆåŠŸç”Ÿæˆ${results.length}ç§è¯­è¨€ç‰ˆæœ¬ï¼`)
  } catch (error) {
    ElMessage.error('ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•')
  } finally {
    generating.value = false
    generateProgress.value = 0
  }
}

// ç”Ÿæˆå•ä¸ªè¯­è¨€çš„ç¿»è¯‘
const generateTranslation = async (language) => {
  const sourceContent = formData.sourceContent
  
  // æ¨¡æ‹Ÿç¿»è¯‘å†…å®¹ç”Ÿæˆ
  let translatedContent = translateContent(sourceContent, language)
  
  // æ ¹æ®æœ¬åœ°åŒ–çº§åˆ«è°ƒæ•´å†…å®¹
  if (formData.localizationLevel === 'standard') {
    translatedContent = applyCulturalAdaptation(translatedContent, language)
  } else if (formData.localizationLevel === 'advanced') {
    translatedContent = applyAdvancedLocalization(translatedContent, language)
  }
  
  // åº”ç”¨è¯­æ°”è°ƒæ•´
  translatedContent = applyToneAdjustments(translatedContent, language, formData.toneAdjustments)
  
  return {
    language,
    content: translatedContent,
    quality: Math.round(85 + Math.random() * 10),
    localization: Math.round(75 + Math.random() * 20),
    rating: 4 + Math.random(),
    suggestions: generateSuggestions(language),
    keywords: generateKeywords(sourceContent, translatedContent)
  }
}

// åŸºç¡€ç¿»è¯‘åŠŸèƒ½
const translateContent = (content, targetLanguage) => {
  // ç®€åŒ–çš„ç¿»è¯‘é€»è¾‘ï¼Œå®é™…åº”è¯¥è°ƒç”¨ç¿»è¯‘API
  const translations = {
    'en': translateToEnglish(content),
    'ja': translateToJapanese(content),
    'ko': translateToKorean(content),
    'de': translateToGerman(content),
    'fr': translateToFrench(content),
    'es': translateToSpanish(content),
    'it': translateToItalian(content),
    'ru': translateToRussian(content)
  }
  
  return translations[targetLanguage] || content
}

// å„è¯­è¨€ç¿»è¯‘å‡½æ•°ï¼ˆç¤ºä¾‹ï¼‰
const translateToEnglish = (content) => {
  return `Discover our innovative products and services that will transform your business experience. We are committed to providing the highest quality solutions to meet your needs.`
}

const translateToJapanese = (content) => {
  return `é©æ–°çš„ãªè£½å“ã¨ã‚µãƒ¼ãƒ“ã‚¹ã‚’ç™ºè¦‹ã—ã€ãƒ“ã‚¸ãƒã‚¹ä½“é¨“ã‚’å¤‰é©ã—ã¾ã—ã‚‡ã†ã€‚ãŠå®¢æ§˜ã®ãƒ‹ãƒ¼ã‚ºã«ãŠå¿œãˆã™ã‚‹æœ€é«˜å“è³ªã®ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æä¾›ã™ã‚‹ã“ã¨ã‚’ãŠç´„æŸã„ãŸã—ã¾ã™ã€‚`
}

const translateToKorean = (content) => {
  return `í˜ì‹ ì ì¸ ì œí’ˆê³¼ ì„œë¹„ìŠ¤ë¥¼ ë°œê²¬í•˜ê³  ë¹„ì¦ˆë‹ˆìŠ¤ ê²½í—˜ì„ í˜ì‹ í•˜ì„¸ìš”. ê³ ê°ì˜ ìš”êµ¬ì‚¬í•­ì„ ì¶©ì¡±í•˜ëŠ” ìµœê³  í’ˆì§ˆì˜ ì†”ë£¨ì…˜ì„ ì œê³µí•˜ëŠ” ê²ƒì„ ì•½ì†ë“œë¦½ë‹ˆë‹¤.`
}

const translateToGerman = (content) => {
  return `Entdecken Sie unsere innovativen Produkte und Dienstleistungen, die Ihr GeschÃ¤ftserlebnis transformieren werden. Wir verpflichten uns, Ihnen qualitativ hochwertige LÃ¶sungen zu bieten.`
}

const translateToFrench = (content) => {
  return `DÃ©couvrez nos produits et services innovants qui transformeront votre expÃ©rience commerciale. Nous nous engageons Ã  fournir des solutions de la plus haute qualitÃ©.`
}

const translateToSpanish = (content) => {
  return `Descubra nuestros productos y servicios innovadores que transformarÃ¡n su experiencia empresarial. Estamos comprometidos a brindar soluciones de la mÃ¡s alta calidad.`
}

const translateToItalian = (content) => {
  return `Scoprite i nostri prodotti e servizi innovativi che trasformeranno la vostra esperienza aziendale. Ci impegniamo a fornire soluzioni di altissima qualitÃ .`
}

const translateToRussian = (content) => {
  return `ĞÑ‚ĞºÑ€Ğ¾Ğ¹Ñ‚Ğµ Ğ´Ğ»Ñ ÑĞµĞ±Ñ Ğ½Ğ°ÑˆĞ¸ Ğ¸Ğ½Ğ½Ğ¾Ğ²Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ñ‹ Ğ¸ ÑƒÑĞ»ÑƒĞ³Ğ¸, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ¿Ñ€ĞµĞ¾Ğ±Ñ€Ğ°Ğ·ÑÑ‚ Ğ²Ğ°Ñˆ Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ¾Ğ¿Ñ‹Ñ‚. ĞœÑ‹ ÑÑ‚Ñ€ĞµĞ¼Ğ¸Ğ¼ÑÑ Ğ¿Ñ€ĞµĞ´Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ÑÑ‚ÑŒ Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ Ğ²Ñ‹ÑĞ¾Ñ‡Ğ°Ğ¹ÑˆĞµĞ³Ğ¾ ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ°.`
}

// æ–‡åŒ–é€‚é…
const applyCulturalAdaptation = (content, language) => {
  // æ ¹æ®æ–‡åŒ–ç‰¹ç‚¹è°ƒæ•´å†…å®¹
  const culturalAdaptations = {
    'ja': (text) => text.replace(/æ‚¨/g, 'ãŠå®¢æ§˜').replace(/æˆ‘ä»¬/g, 'ç§ã©ã‚‚'),
    'ko': (text) => text.replace(/æ‚¨/g, 'ê³ ê°ë‹˜').replace(/æˆ‘ä»¬/g, 'ì €í¬'),
    'de': (text) => text.replace(/ä½ å¥½/g, 'Guten Tag'),
    'fr': (text) => text.replace(/ä½ å¥½/g, 'Bonjour')
  }
  
  return culturalAdaptations[language] ? culturalAdaptations[language](content) : content
}

// é«˜çº§æœ¬åœ°åŒ–
const applyAdvancedLocalization = (content, language) => {
  // æ·±åº¦æœ¬åœ°åŒ–è°ƒæ•´
  content = applyCulturalAdaptation(content, language)
  
  // æ·»åŠ å¸‚åœºç‰¹è‰²è°ƒæ•´
  if (language === 'ja') {
    content = content + ' ã©ã†ãã‚ˆã‚ã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚'
  } else if (language === 'ko') {
    content = content + ' ê°ì‚¬í•©ë‹ˆë‹¤.'
  }
  
  return content
}

// è¯­æ°”è°ƒæ•´
const applyToneAdjustments = (content, language, adjustments) => {
  adjustments.forEach(adjustment => {
    switch (adjustment) {
      case 'formal':
        // å¢åŠ æ­£å¼æ„Ÿ
        if (language === 'en') {
          content = content.replace(/we're/g, 'we are').replace(/don't/g, 'do not')
        }
        break
      case 'respectful':
        // å¢åŠ ç¤¼è²Œæ€§
        if (language === 'ja') {
          content = content.replace(/ã§ã™/g, 'ã§ã”ã–ã„ã¾ã™')
        }
        break
    }
  })
  
  return content
}

// ç”Ÿæˆæœ¬åœ°åŒ–å»ºè®®
const generateSuggestions = (language) => {
  const suggestions = {
    'ja': [
      { title: 'æ•¬è¯­ä½¿ç”¨', description: 'å»ºè®®åœ¨å•†ä¸šç¯å¢ƒä¸­ä½¿ç”¨æ›´å¤šæ•¬è¯­è¡¨è¾¾' },
      { title: 'æ–‡åŒ–é€‚åº”', description: 'è€ƒè™‘æ—¥æœ¬å•†åŠ¡æ–‡åŒ–çš„å«è“„ç‰¹ç‚¹' }
    ],
    'ko': [
      { title: 'å°Šæ•¬è¯­', description: 'ä½¿ç”¨é€‚å½“çš„å°Šæ•¬è¯­å½¢å¼' },
      { title: 'æ–‡åŒ–æ•æ„Ÿ', description: 'æ³¨æ„éŸ©å›½å•†ä¸šæ–‡åŒ–çš„å±‚çº§å…³ç³»' }
    ],
    'de': [
      { title: 'æ­£å¼æ€§', description: 'å¾·è¯­å•†åŠ¡äº¤æµå€¾å‘äºæ›´åŠ æ­£å¼' },
      { title: 'å‡†ç¡®æ€§', description: 'å¾·è¯­é‡è§†å‡†ç¡®å’Œè¯¦ç»†çš„ä¿¡æ¯' }
    ]
  }
  
  return suggestions[language] || []
}

// ç”Ÿæˆå…³é”®è¯å¯¹ç…§
const generateKeywords = (sourceContent, translatedContent) => {
  return [
    { source: 'äº§å“', target: 'Product', note: 'æ ¸å¿ƒä¸šåŠ¡æœ¯è¯­' },
    { source: 'æœåŠ¡', target: 'Service', note: 'æœåŠ¡ç±»åˆ«' },
    { source: 'è´¨é‡', target: 'Quality', note: 'å“è´¨ç›¸å…³' }
  ]
}

// å¤åˆ¶ç¿»è¯‘
const copyTranslation = async (content) => {
  try {
    await navigator.clipboard.writeText(content)
    ElMessage.success('ç¿»è¯‘å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿')
  } catch (error) {
    ElMessage.error('å¤åˆ¶å¤±è´¥')
  }
}

// ç¼–è¾‘ç¿»è¯‘
const editTranslation = (translation) => {
  editForm.language = translation.language
  editForm.content = translation.content
  editDialogVisible.value = true
}

// ä¿å­˜ç¼–è¾‘
const saveTranslationEdit = () => {
  const translation = translations.value.find(t => t.language === editForm.language)
  if (translation) {
    translation.content = editForm.content
    editDialogVisible.value = false
    ElMessage.success('ç¼–è¾‘ä¿å­˜æˆåŠŸ')
  }
}

// é‡æ–°ç”Ÿæˆç¿»è¯‘
const regenerateTranslation = async (language) => {
  const index = translations.value.findIndex(t => t.language === language)
  if (index >= 0) {
    ElMessage.loading('æ­£åœ¨é‡æ–°ç”Ÿæˆç¿»è¯‘...')
    await new Promise(resolve => setTimeout(resolve, 2000))
    
    const newTranslation = await generateTranslation(language)
    translations.value[index] = newTranslation
    
    ElMessage.success('ç¿»è¯‘å·²é‡æ–°ç”Ÿæˆ')
  }
}

// æ›´æ–°è¯„åˆ†
const updateRating = (language, rating) => {
  const translation = translations.value.find(t => t.language === language)
  if (translation) {
    translation.rating = rating
  }
}

// ä¿å­˜åˆ°åº“
const saveToLibrary = (translation) => {
  ElMessage.success('ç¿»è¯‘å·²ä¿å­˜åˆ°ç¿»è¯‘åº“')
}

// åº”ç”¨ç¿»è¯‘
const applyTranslation = (translation) => {
  ElMessage.success(`${getLanguageLabel(translation.language)}ç‰ˆæœ¬å·²åº”ç”¨`)
}

// å¯¼å‡ºç¿»è¯‘
const exportTranslations = () => {
  const data = translations.value.map(translation => ({
    è¯­è¨€: getLanguageLabel(translation.language),
    å†…å®¹: translation.content,
    è´¨é‡: translation.quality + '%',
    æœ¬åœ°åŒ–ç¨‹åº¦: translation.localization + '%',
    è¯„åˆ†: translation.rating
  }))
  
  const csv = convertToCSV(data)
  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' })
  const link = document.createElement('a')
  const url = URL.createObjectURL(blob)
  link.setAttribute('href', url)
  link.setAttribute('download', `å¤šè¯­è¨€ç¿»è¯‘_${new Date().toISOString().split('T')[0]}.csv`)
  link.click()
  URL.revokeObjectURL(url)
  
  ElMessage.success('ç¿»è¯‘ç»“æœå·²å¯¼å‡º')
}

// è½¬æ¢ä¸ºCSV
const convertToCSV = (data) => {
  if (!data.length) return ''
  
  const headers = Object.keys(data[0])
  const csvContent = [
    headers.join(','),
    ...data.map(row => headers.map(header => `"${row[header]}"`).join(','))
  ].join('\n')
  
  return '\uFEFF' + csvContent
}

// æœ¯è¯­åº“ç®¡ç†
const addGlossaryTerm = () => {
  glossaryTerms.value.push({
    source: '',
    target: '',
    category: '',
    note: ''
  })
}

const editGlossaryTerm = (term) => {
  // ç¼–è¾‘æœ¯è¯­é€»è¾‘
}

const deleteGlossaryTerm = (index) => {
  glossaryTerms.value.splice(index, 1)
}
</script>

<style lang="scss" scoped>
.multi-language-page {
  padding: 20px;
  background-color: #f5f7fa;
}

.page-header {
  margin-bottom: 24px;
  
  h1 {
    font-size: 28px;
    font-weight: 600;
    color: #303133;
    margin: 0 0 8px 0;
  }
  
  .page-desc {
    color: #606266;
    font-size: 14px;
    margin: 0;
  }
}

.card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  
  span {
    font-weight: 600;
    color: #303133;
  }
}

.config-panel {
  height: fit-content;
  
  .language-selection {
    .language-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      
      .language-item {
        border: 1px solid #dcdfe6;
        border-radius: 8px;
        padding: 12px;
        transition: all 0.3s;
        
        &:hover {
          border-color: #409eff;
        }
        
        .language-content {
          display: flex;
          align-items: center;
          gap: 8px;
          
          .flag {
            font-size: 18px;
          }
        }
      }
    }
  }
  
  .localization-hint {
    margin-top: 8px;
    
    p {
      margin: 0;
      font-size: 12px;
      color: #909399;
    }
  }
  
  .glossary-selection {
    margin-top: 8px;
  }
  
  .usage-stats {
    margin-top: 24px;
    padding: 16px;
    background-color: #f8f9fa;
    border-radius: 8px;
    
    .stats-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
  }
}

.results-panel {
  min-height: 600px;
}

.loading-container {
  text-align: center;
  padding: 40px 20px;
  
  .loading-text {
    margin: 20px 0;
    color: #606266;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    
    .rotating {
      animation: rotate 1s linear infinite;
    }
  }
}

@keyframes rotate {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

.compare-view {
  .source-content {
    margin-bottom: 24px;
    
    h3 {
      margin: 0 0 12px 0;
      color: #303133;
    }
    
    .content-box.source {
      background-color: #f0f9ff;
      border: 1px solid #bfdbfe;
    }
  }
  
  .translations-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 20px;
  }
  
  .translation-item {
    border: 1px solid #e4e7ed;
    border-radius: 12px;
    padding: 16px;
    background-color: white;
    
    .translation-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      
      .language-name {
        font-weight: 600;
        color: #303133;
      }
    }
    
    .content-box {
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 12px;
      
      &.translation {
        background-color: #f8f9fa;
        border: 1px solid #e9ecef;
      }
      
      .translation-content {
        line-height: 1.6;
        margin-bottom: 8px;
      }
      
      .translation-meta {
        display: flex;
        gap: 8px;
      }
    }
    
    .translation-tools {
      display: flex;
      justify-content: center;
    }
  }
}

.list-view {
  .translation-detail {
    .translation-stats {
      margin-bottom: 24px;
      padding: 20px;
      background-color: #f8f9fa;
      border-radius: 8px;
      
      .rating-section {
        display: flex;
        align-items: center;
        gap: 8px;
        
        .rating-label {
          font-size: 14px;
          color: #606266;
        }
      }
    }
    
    .translation-content-section,
    .suggestions-section,
    .keywords-section {
      margin-bottom: 24px;
      
      h4 {
        margin: 0 0 12px 0;
        color: #303133;
        font-size: 16px;
      }
    }
    
    .content-display {
      .translation-textarea {
        :deep(.el-textarea__inner) {
          background-color: #fafafa;
          border: 1px solid #e4e7ed;
        }
      }
    }
    
    .suggestion-item {
      margin-bottom: 8px;
    }
    
    .translation-actions-full {
      display: flex;
      justify-content: center;
      padding-top: 20px;
      border-top: 1px solid #e4e7ed;
    }
  }
}

.empty-state {
  text-align: center;
  padding: 60px 20px;
  
  .empty-icon {
    font-size: 48px;
    color: #c0c4cc;
    margin-bottom: 16px;
  }
  
  p {
    color: #909399;
    margin: 16px 0 0 0;
  }
}

.glossary-manager {
  .glossary-header {
    margin-bottom: 16px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
}

@media (max-width: 768px) {
  .multi-language-page {
    padding: 12px;
  }
  
  .el-row {
    margin: 0 !important;
  }
  
  .el-col {
    padding: 0 !important;
    
    &:first-child {
      margin-bottom: 20px;
    }
  }
  
  .language-grid {
    grid-template-columns: 1fr !important;
  }
  
  .translations-grid {
    grid-template-columns: 1fr !important;
  }
}
</style>