<template>
  <div class="social-content-page">
    <!-- é¡µé¢æ ‡é¢˜ -->
    <div class="page-header">
      <h1>ç¤¾åª’è¯æœ¯ç”Ÿæˆ</h1>
      <p class="page-desc">ä¸ºä¸åŒç¤¾äº¤åª’ä½“å¹³å°ç”Ÿæˆä¸“ä¸šçš„è¥é”€è¯æœ¯ï¼Œæ”¯æŒæ‰¹é‡ç”Ÿæˆå’Œå¤šå¹³å°é€‚é…</p>
    </div>

    <el-row :gutter="24">
      <!-- å‚æ•°é…ç½®é¢æ¿ -->
      <el-col :span="8">
        <el-card class="config-panel">
          <template #header>
            <div class="card-header">
              <span>ç”Ÿæˆé…ç½®</span>
              <el-tooltip content="é…ç½®ç¤¾åª’è¯æœ¯ç”Ÿæˆå‚æ•°">
                <el-icon><InfoFilled /></el-icon>
              </el-tooltip>
            </div>
          </template>

          <el-form :model="formData" label-width="120px" size="default">
            <!-- ç¤¾åª’å¹³å°é€‰æ‹© -->
            <el-form-item label="ç›®æ ‡å¹³å°">
              <el-checkbox-group v-model="formData.platforms">
                <div class="platform-grid">
                  <el-checkbox label="facebook" class="platform-item">
                    <div class="platform-content">
                      <el-icon class="platform-icon facebook"><Platform /></el-icon>
                      <span>Facebook</span>
                    </div>
                  </el-checkbox>
                  <el-checkbox label="instagram" class="platform-item">
                    <div class="platform-content">
                      <el-icon class="platform-icon instagram"><Camera /></el-icon>
                      <span>Instagram</span>
                    </div>
                  </el-checkbox>
                  <el-checkbox label="twitter" class="platform-item">
                    <div class="platform-content">
                      <el-icon class="platform-icon twitter"><ChatLineSquare /></el-icon>
                      <span>Twitter/X</span>
                    </div>
                  </el-checkbox>
                  <el-checkbox label="linkedin" class="platform-item">
                    <div class="platform-content">
                      <el-icon class="platform-icon linkedin"><Briefcase /></el-icon>
                      <span>LinkedIn</span>
                    </div>
                  </el-checkbox>
                  <el-checkbox label="tiktok" class="platform-item">
                    <div class="platform-content">
                      <el-icon class="platform-icon tiktok"><VideoPlay /></el-icon>
                      <span>TikTok</span>
                    </div>
                  </el-checkbox>
                  <el-checkbox label="youtube" class="platform-item">
                    <div class="platform-content">
                      <el-icon class="platform-icon youtube"><VideoCamera /></el-icon>
                      <span>YouTube</span>
                    </div>
                  </el-checkbox>
                </div>
              </el-checkbox-group>
            </el-form-item>

            <!-- å†…å®¹ç±»å‹ -->
            <el-form-item label="å†…å®¹ç±»å‹">
              <el-select v-model="formData.contentType" placeholder="è¯·é€‰æ‹©å†…å®¹ç±»å‹" style="width: 100%">
                <el-option label="äº§å“æ¨å¹¿" value="product-promotion" />
                <el-option label="å“ç‰Œå®£ä¼ " value="brand-awareness" />
                <el-option label="æ´»åŠ¨æ¨å¹¿" value="event-promotion" />
                <el-option label="ç”¨æˆ·æ•™è‚²" value="education" />
                <el-option label="å®¢æˆ·æ•…äº‹" value="customer-story" />
                <el-option label="è¡Œä¸šèµ„è®¯" value="industry-news" />
                <el-option label="èŠ‚æ—¥è¥é”€" value="holiday-marketing" />
                <el-option label="äº’åŠ¨è¯é¢˜" value="engagement" />
              </el-select>
            </el-form-item>

            <!-- æ ¸å¿ƒä¿¡æ¯ -->
            <el-form-item label="æ ¸å¿ƒä¿¡æ¯">
              <el-input 
                v-model="formData.coreMessage" 
                type="textarea"
                :rows="3"
                placeholder="è¯·è¾“å…¥è¦ä¼ è¾¾çš„æ ¸å¿ƒä¿¡æ¯æˆ–å…³é”®è¯"
                maxlength="200"
                show-word-limit
              />
            </el-form-item>

            <!-- ç›®æ ‡å—ä¼— -->
            <el-form-item label="ç›®æ ‡å—ä¼—">
              <el-select v-model="formData.targetAudience" placeholder="è¯·é€‰æ‹©ç›®æ ‡å—ä¼—" style="width: 100%">
                <el-option label="å¹´è½»æ¶ˆè´¹è€…(18-30)" value="young-consumers" />
                <el-option label="èŒåœºäººå£«(25-40)" value="professionals" />
                <el-option label="ä¸­å¹´ç¾¤ä½“(35-50)" value="middle-aged" />
                <el-option label="ä¼ä¸šå†³ç­–è€…" value="decision-makers" />
                <el-option label="å­¦ç”Ÿç¾¤ä½“" value="students" />
                <el-option label="å®¶åº­ä¸»å¦‡" value="housewives" />
                <el-option label="è€å¹´ç¾¤ä½“" value="seniors" />
                <el-option label="ç§‘æŠ€çˆ±å¥½è€…" value="tech-enthusiasts" />
              </el-select>
            </el-form-item>

            <!-- è¯­æ°”é£æ ¼ -->
            <el-form-item label="è¯­æ°”é£æ ¼">
              <el-radio-group v-model="formData.tone">
                <el-radio label="professional">ä¸“ä¸šä¸¥è‚ƒ</el-radio>
                <el-radio label="friendly">å‹å¥½äº²åˆ‡</el-radio>
                <el-radio label="humorous">å¹½é»˜é£è¶£</el-radio>
                <el-radio label="inspiring">æ¿€åŠ±å‘ä¸Š</el-radio>
                <el-radio label="casual">è½»æ¾éšæ„</el-radio>
              </el-radio-group>
            </el-form-item>

            <!-- è¯æœ¯é•¿åº¦ -->
            <el-form-item label="è¯æœ¯é•¿åº¦">
              <div class="length-settings">
                <el-radio-group v-model="formData.lengthMode">
                  <el-radio label="auto">æ™ºèƒ½é€‚é…</el-radio>
                  <el-radio label="custom">è‡ªå®šä¹‰</el-radio>
                </el-radio-group>
                
                <div v-if="formData.lengthMode === 'custom'" class="custom-length">
                  <el-slider
                    v-model="formData.customLength"
                    :min="50"
                    :max="2000"
                    :step="50"
                    show-stops
                    show-input
                  />
                  <p class="length-hint">å»ºè®®å­—æ•°èŒƒå›´ï¼š{{ getRecommendedLength() }}</p>
                </div>
              </div>
            </el-form-item>

            <!-- æ ‡ç­¾å’Œè¯é¢˜ -->
            <el-form-item label="ç›¸å…³æ ‡ç­¾">
              <el-input 
                v-model="formData.hashtags" 
                placeholder="è¯·è¾“å…¥ç›¸å…³æ ‡ç­¾ï¼Œç”¨é€—å·åˆ†éš”"
                maxlength="100"
              />
              <div class="hashtag-suggestions">
                <el-tag 
                  v-for="tag in hashtagSuggestions" 
                  :key="tag"
                  size="small"
                  class="suggestion-tag"
                  @click="addHashtag(tag)"
                >
                  {{ tag }}
                </el-tag>
              </div>
            </el-form-item>

            <!-- äº’åŠ¨å…ƒç´  -->
            <el-form-item label="äº’åŠ¨å…ƒç´ ">
              <el-checkbox-group v-model="formData.interactionElements">
                <el-checkbox label="call-to-action">è¡ŒåŠ¨å·å¬</el-checkbox>
                <el-checkbox label="question">æé—®äº’åŠ¨</el-checkbox>
                <el-checkbox label="emoji">è¡¨æƒ…ç¬¦å·</el-checkbox>
                <el-checkbox label="mention">@æåŠ</el-checkbox>
                <el-checkbox label="poll">æŠ•ç¥¨åŠŸèƒ½</el-checkbox>
                <el-checkbox label="contest">æŠ½å¥–æ´»åŠ¨</el-checkbox>
              </el-checkbox-group>
            </el-form-item>

            <!-- ç”Ÿæˆæ•°é‡ -->
            <el-form-item label="ç”Ÿæˆæ•°é‡">
              <el-radio-group v-model="formData.generateCount">
                <el-radio :label="3">3ä¸ªç‰ˆæœ¬</el-radio>
                <el-radio :label="5">5ä¸ªç‰ˆæœ¬</el-radio>
                <el-radio :label="10">10ä¸ªç‰ˆæœ¬</el-radio>
              </el-radio-group>
            </el-form-item>

            <!-- AIæ¨¡å‹ -->
            <el-form-item label="AIæ¨¡å‹">
              <el-select v-model="formData.aiModel" style="width: 100%">
                <el-option label="GPT-4 (æ¨è)" value="gpt-4" />
                <el-option label="GPT-3.5 Turbo" value="gpt-3.5-turbo" />
                <el-option label="Claude-3" value="claude-3" />
                <el-option label="æ–‡å¿ƒä¸€è¨€" value="ernie-bot" />
              </el-select>
            </el-form-item>

            <!-- ç”ŸæˆæŒ‰é’® -->
            <el-form-item>
              <el-button 
                type="primary" 
                :loading="generating" 
                @click="generateContent"
                :disabled="!canGenerate"
                style="width: 100%"
                size="large"
              >
                <el-icon v-if="!generating"><MagicStick /></el-icon>
                {{ generating ? 'ç”Ÿæˆä¸­...' : 'æ‰¹é‡ç”Ÿæˆè¯æœ¯' }}
              </el-button>
            </el-form-item>

            <!-- ä½¿ç”¨ç»Ÿè®¡ -->
            <div class="usage-stats">
              <el-divider>ä»Šæ—¥ä½¿ç”¨é‡</el-divider>
              <div class="stats-item">
                <span>å·²ç”Ÿæˆï¼š</span>
                <el-tag type="success">{{ dailyUsage }}/100</el-tag>
              </div>
              <el-progress 
                :percentage="Math.round((dailyUsage / 100) * 100)" 
                :color="progressColor"
                :stroke-width="8"
              />
            </div>
          </el-form>
        </el-card>
      </el-col>

      <!-- ç”Ÿæˆç»“æœé¢æ¿ -->
      <el-col :span="16">
        <el-card class="results-panel">
          <template #header>
            <div class="card-header">
              <span>ç”Ÿæˆç»“æœ</span>
              <div class="header-actions" v-if="generatedResults.length > 0">
                <el-button @click="exportAll" size="small" :icon="Download">
                  å¯¼å‡ºå…¨éƒ¨
                </el-button>
                <el-button @click="clearResults" size="small" type="danger" text>
                  <el-icon><Delete /></el-icon>
                  æ¸…ç©ºç»“æœ
                </el-button>
              </div>
            </div>
          </template>

          <!-- åŠ è½½çŠ¶æ€ -->
          <div v-if="generating" class="loading-container">
            <el-skeleton :rows="6" animated />
            <div class="loading-text">
              <el-icon class="rotating"><Loading /></el-icon>
              AIæ­£åœ¨ä¸º{{ formData.platforms.length }}ä¸ªå¹³å°ç”Ÿæˆ{{ formData.generateCount }}ä¸ªè¯æœ¯ç‰ˆæœ¬...
            </div>
            <el-progress :percentage="generateProgress" :stroke-width="8" />
          </div>

          <!-- ç”Ÿæˆç»“æœ -->
          <div v-else-if="generatedResults.length > 0" class="results-container">
            <!-- å¹³å°æ ‡ç­¾åˆ‡æ¢ -->
            <el-tabs v-model="activePlatform" type="border-card">
              <el-tab-pane 
                v-for="platform in formData.platforms" 
                :key="platform"
                :label="getPlatformLabel(platform)"
                :name="platform"
              >
                <!-- å¹³å°ä¿¡æ¯æ¦‚è§ˆ -->
                <div class="platform-overview">
                  <el-row :gutter="16">
                    <el-col :span="6">
                      <el-statistic title="ç”Ÿæˆæ•°é‡" :value="getPlatformResults(platform).length" />
                    </el-col>
                    <el-col :span="6">
                      <el-statistic title="å¹³å‡å­—æ•°" :value="getAverageLength(platform)" />
                    </el-col>
                    <el-col :span="6">
                      <el-statistic title="å­—æ•°é™åˆ¶" :value="getPlatformLimit(platform)" />
                    </el-col>
                    <el-col :span="6">
                      <div class="quality-score">
                        <span class="score-label">æ•´ä½“è¯„åˆ†ï¼š</span>
                        <el-rate 
                          :value="getAverageRating(platform)" 
                          disabled 
                          show-score
                          text-color="#ff9900"
                          score-template="{value} åˆ†"
                        />
                      </div>
                    </el-col>
                  </el-row>
                </div>

                <!-- è¯æœ¯åˆ—è¡¨ -->
                <div class="content-list">
                  <div 
                    v-for="(content, index) in getPlatformResults(platform)" 
                    :key="index"
                    class="content-item"
                  >
                    <div class="content-header">
                      <div class="content-meta">
                        <el-tag size="small">ç‰ˆæœ¬{{ index + 1 }}</el-tag>
                        <el-tag size="small" :type="getLengthType(content.length, platform)">
                          {{ content.length }}å­—
                        </el-tag>
                        <el-tag size="small" type="info" v-if="content.hashtags">
                          {{ content.hashtags.length }}ä¸ªæ ‡ç­¾
                        </el-tag>
                      </div>
                      <div class="content-actions">
                        <el-rate 
                          v-model="content.rating" 
                          size="small"
                          @change="updateRating(platform, index, $event)"
                        />
                      </div>
                    </div>

                    <div class="content-body">
                      <div class="content-text">{{ content.text }}</div>
                      <div v-if="content.hashtags && content.hashtags.length > 0" class="content-hashtags">
                        <el-tag 
                          v-for="tag in content.hashtags" 
                          :key="tag"
                          size="small"
                          type="primary"
                          class="hashtag-item"
                        >
                          #{{ tag }}
                        </el-tag>
                      </div>
                    </div>

                    <div class="content-footer">
                      <el-button-group size="small">
                        <el-button @click="copyContent(content.text)" :icon="DocumentCopy">
                          å¤åˆ¶
                        </el-button>
                        <el-button @click="editContent(platform, index)" :icon="Edit">
                          ç¼–è¾‘
                        </el-button>
                        <el-button @click="shareContent(content)" :icon="Share">
                          åˆ†äº«
                        </el-button>
                        <el-button @click="publishContent(platform, content)" :icon="Promotion" type="primary">
                          å‘å¸ƒåˆ°{{ getPlatformLabel(platform) }}
                        </el-button>
                      </el-button-group>
                    </div>
                  </div>
                </div>
              </el-tab-pane>
            </el-tabs>
          </div>

          <!-- ç©ºçŠ¶æ€ -->
          <div v-else class="empty-state">
            <el-empty description="è¯·é…ç½®å‚æ•°å¹¶ç‚¹å‡»ç”ŸæˆæŒ‰é’®">
              <el-icon class="empty-icon"><ChatDotSquare /></el-icon>
              <p>é€‰æ‹©ç›®æ ‡å¹³å°ï¼ŒAIå°†ä¸ºæ‚¨ç”Ÿæˆä¸“ä¸šçš„ç¤¾åª’è¯æœ¯</p>
            </el-empty>
          </div>
        </el-card>
      </el-col>
    </el-row>

    <!-- ç¼–è¾‘å¯¹è¯æ¡† -->
    <el-dialog 
      v-model="editDialogVisible"
      title="ç¼–è¾‘è¯æœ¯å†…å®¹"
      width="70%"
      destroy-on-close
    >
      <el-form :model="editForm" label-width="100px">
        <el-form-item label="å¹³å°">
          <el-tag>{{ getPlatformLabel(editForm.platform) }}</el-tag>
        </el-form-item>
        <el-form-item label="å†…å®¹">
          <el-input 
            v-model="editForm.text"
            type="textarea"
            :rows="8"
            :maxlength="getPlatformLimit(editForm.platform)"
            show-word-limit
          />
        </el-form-item>
        <el-form-item label="æ ‡ç­¾">
          <el-input 
            v-model="editForm.hashtagsText"
            placeholder="è¯·è¾“å…¥æ ‡ç­¾ï¼Œç”¨é€—å·åˆ†éš”"
          />
        </el-form-item>
      </el-form>
      
      <template #footer>
        <span class="dialog-footer">
          <el-button @click="editDialogVisible = false">å–æ¶ˆ</el-button>
          <el-button type="primary" @click="saveEdit">ä¿å­˜</el-button>
        </span>
      </template>
    </el-dialog>
  </div>
</template>

<script setup>
import { ref, reactive, computed, watch } from 'vue'
import { ElMessage, ElMessageBox } from 'element-plus'
import {
  InfoFilled, MagicStick, Loading, DocumentCopy, Download, Delete, Edit, 
  Share, Promotion, ChatDotSquare, Platform, Camera, ChatLineSquare,
  Briefcase, VideoPlay, VideoCamera
} from '@element-plus/icons-vue'

// è¡¨å•æ•°æ®
const formData = reactive({
  platforms: [],
  contentType: '',
  coreMessage: '',
  targetAudience: '',
  tone: 'friendly',
  lengthMode: 'auto',
  customLength: 280,
  hashtags: '',
  interactionElements: ['call-to-action', 'emoji'],
  generateCount: 3,
  aiModel: 'gpt-4'
})

// ç”ŸæˆçŠ¶æ€
const generating = ref(false)
const generateProgress = ref(0)
const dailyUsage = ref(24)
const activePlatform = ref('')
const generatedResults = ref([])

// ç¼–è¾‘å¯¹è¯æ¡†
const editDialogVisible = ref(false)
const editForm = reactive({
  platform: '',
  index: -1,
  text: '',
  hashtagsText: ''
})

// æ ‡ç­¾å»ºè®®
const hashtagSuggestions = ref([
  'è¥é”€', 'æ¨å¹¿', 'å“ç‰Œ', 'äº§å“', 'ä¼˜æƒ ', 'é™æ—¶', 'æ–°å“', 'çƒ­é—¨', 
  'ä¸“ä¸š', 'æœåŠ¡', 'è´¨é‡', 'åˆ›æ–°', 'ä½“éªŒ', 'æ¨è', 'å¿…ä¹°', 'å¥½ç‰©'
])

// è®¡ç®—å±æ€§
const canGenerate = computed(() => {
  return formData.platforms.length > 0 && 
         formData.contentType && 
         formData.coreMessage.trim() && 
         dailyUsage.value < 100
})

const progressColor = computed(() => {
  const percentage = (dailyUsage.value / 100) * 100
  if (percentage < 50) return '#67c23a'
  if (percentage < 80) return '#e6a23c'
  return '#f56c6c'
})

// ç›‘å¬å¹³å°å˜åŒ–ï¼Œè®¾ç½®é»˜è®¤æ¿€æ´»å¹³å°
watch(() => formData.platforms, (newPlatforms) => {
  if (newPlatforms.length > 0 && !activePlatform.value) {
    activePlatform.value = newPlatforms[0]
  }
}, { immediate: true })

// è·å–æ¨èé•¿åº¦
const getRecommendedLength = () => {
  const ranges = {
    twitter: '50-280å­—',
    instagram: '125-2200å­—',
    facebook: '40-80å­—ï¼ˆæœ€ä½³ï¼‰ï¼Œæœ€å¤š2000å­—',
    linkedin: '150-300å­—',
    tiktok: '100-150å­—',
    youtube: '125-1000å­—'
  }
  
  const selectedPlatforms = formData.platforms
  if (selectedPlatforms.length === 1) {
    return ranges[selectedPlatforms[0]] || '50-500å­—'
  }
  return 'æ ¹æ®å¹³å°è‡ªåŠ¨è°ƒæ•´'
}

// ç”Ÿæˆå†…å®¹
const generateContent = async () => {
  if (!canGenerate.value) {
    ElMessage.warning('è¯·å®Œå–„å¿…å¡«å‚æ•°æˆ–æ£€æŸ¥ä»Šæ—¥ä½¿ç”¨é‡')
    return
  }

  generating.value = true
  generateProgress.value = 0
  
  try {
    const results = []
    
    // ä¸ºæ¯ä¸ªå¹³å°ç”Ÿæˆå†…å®¹
    for (let platformIndex = 0; platformIndex < formData.platforms.length; platformIndex++) {
      const platform = formData.platforms[platformIndex]
      
      for (let i = 0; i < formData.generateCount; i++) {
        // æ¨¡æ‹Ÿç”Ÿæˆè¿›åº¦
        generateProgress.value = Math.round(((platformIndex * formData.generateCount + i + 1) / 
          (formData.platforms.length * formData.generateCount)) * 100)
        
        await new Promise(resolve => setTimeout(resolve, 500))
        
        // ç”Ÿæˆå†…å®¹
        const content = generatePlatformContent(platform, i)
        results.push({
          platform,
          ...content,
          rating: 4 + Math.random()
        })
      }
    }
    
    generatedResults.value = results
    activePlatform.value = formData.platforms[0]
    dailyUsage.value += formData.platforms.length * formData.generateCount
    
    ElMessage.success(`æˆåŠŸç”Ÿæˆ${results.length}æ¡è¯æœ¯å†…å®¹ï¼`)
  } catch (error) {
    ElMessage.error('ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•')
  } finally {
    generating.value = false
    generateProgress.value = 0
  }
}

// ä¸ºç‰¹å®šå¹³å°ç”Ÿæˆå†…å®¹
const generatePlatformContent = (platform, variant) => {
  const platformLimits = {
    twitter: 280,
    instagram: 2200,
    facebook: 500,
    linkedin: 700,
    tiktok: 150,
    youtube: 1000
  }
  
  const limit = platformLimits[platform] || 500
  const targetLength = formData.lengthMode === 'custom' ? 
    formData.customLength : Math.round(limit * 0.7)
  
  // åŸºç¡€å†…å®¹ç”Ÿæˆ
  let content = generateBaseContent(platform, variant, targetLength)
  
  // æ·»åŠ äº’åŠ¨å…ƒç´ 
  if (formData.interactionElements.includes('emoji')) {
    content = addEmojis(content, platform)
  }
  
  if (formData.interactionElements.includes('call-to-action')) {
    content = addCallToAction(content, platform)
  }
  
  if (formData.interactionElements.includes('question')) {
    content = addQuestion(content, platform)
  }
  
  // ç”Ÿæˆæ ‡ç­¾
  const hashtags = generateHashtags(platform)
  
  return {
    text: content,
    length: content.length,
    hashtags: hashtags,
    variant: variant + 1
  }
}

// ç”ŸæˆåŸºç¡€å†…å®¹
const generateBaseContent = (platform, variant, targetLength) => {
  const coreMessage = formData.coreMessage
  const contentType = formData.contentType
  const tone = formData.tone
  
  let content = ''
  
  // æ ¹æ®å¹³å°ç‰¹ç‚¹è°ƒæ•´å¼€å¤´
  const openings = {
    twitter: ['ğŸ’¡ ', 'ğŸ”¥ ', 'âš¡ '],
    instagram: ['âœ¨ æƒ³è¦', 'ğŸ’« å‘ç°', 'ğŸŒŸ åˆ†äº«'],
    facebook: ['æœ‹å‹ä»¬ï¼Œ', 'å¤§å®¶å¥½ï¼', 'å’Œå¤§å®¶åˆ†äº«ä¸€ä¸ª'],
    linkedin: ['åœ¨è¿™ä¸ªè¡Œä¸šä¸­ï¼Œ', 'ä½œä¸ºä¸“ä¸šäººå£«ï¼Œ', 'æ ¹æ®æœ€æ–°è¶‹åŠ¿ï¼Œ'],
    tiktok: ['å“‡ï¼', 'å¤ªèµäº†ï¼', 'å¿…é¡»å®‰åˆ©ï¼'],
    youtube: ['ä»Šå¤©å’Œå¤§å®¶èŠèŠ', 'è¿™æœŸè§†é¢‘ä¸ºå¤§å®¶ä»‹ç»', 'å¾ˆå¤šäººé—®æˆ‘å…³äº']
  }
  
  const opening = openings[platform] ? 
    openings[platform][variant % openings[platform].length] : ''
  
  content = opening + coreMessage
  
  // æ ¹æ®è¯­æ°”è°ƒæ•´å†…å®¹
  if (tone === 'professional') {
    content += 'ï¼Œè¿™æ˜¯ä¸€ä¸ªå€¼å¾—å…³æ³¨çš„ä¸“ä¸šè§£å†³æ–¹æ¡ˆã€‚'
  } else if (tone === 'friendly') {
    content += 'ï¼ŒçœŸçš„è¶…çº§æ¨èç»™å¤§å®¶ï¼'
  } else if (tone === 'humorous') {
    content += 'ï¼Œä¸è¯•è¯•ä½ ä¼šåæ‚”çš„å“¦ğŸ˜„'
  }
  
  // è°ƒæ•´åˆ°ç›®æ ‡é•¿åº¦
  if (content.length < targetLength * 0.8) {
    content += getAdditionalContent(platform, contentType)
  }
  
  return content.substring(0, targetLength)
}

// æ·»åŠ è¡¨æƒ…ç¬¦å·
const addEmojis = (content, platform) => {
  const emojis = {
    twitter: ['ğŸš€', 'ğŸ’', 'ğŸ”¥', 'â­', 'ğŸ’¡'],
    instagram: ['âœ¨', 'ğŸ’«', 'ğŸŒŸ', 'ğŸ’–', 'ğŸ‰'],
    facebook: ['ğŸ‘', 'â¤ï¸', 'ğŸ”¥', 'ğŸ’¯', 'ğŸ¯'],
    linkedin: ['ğŸ“ˆ', 'ğŸ’¼', 'ğŸ¯', 'ğŸš€', 'ğŸ’¡'],
    tiktok: ['ğŸ”¥', 'ğŸ’–', 'âœ¨', 'ğŸ‰', 'ğŸ’¯'],
    youtube: ['ğŸ‘€', 'ğŸ“º', 'ğŸ‘‡', 'ğŸ””', 'â¤ï¸']
  }
  
  const platformEmojis = emojis[platform] || emojis.facebook
  const randomEmoji = platformEmojis[Math.floor(Math.random() * platformEmojis.length)]
  
  return content + ' ' + randomEmoji
}

// æ·»åŠ è¡ŒåŠ¨å·å¬
const addCallToAction = (content, platform) => {
  const ctas = {
    twitter: ['ç‚¹å‡»äº†è§£æ›´å¤š', 'è½¬å‘åˆ†äº«', 'å…³æ³¨æˆ‘ä»¬'],
    instagram: ['ç‚¹èµæ”¶è—', 'å…³æ³¨äº†è§£æ›´å¤š', 'è¯„è®ºåŒºè§'],
    facebook: ['åˆ†äº«ç»™æœ‹å‹', 'ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…', 'ç•™è¨€è®¨è®º'],
    linkedin: ['äº†è§£æ›´å¤šä¿¡æ¯', 'è”ç³»æˆ‘ä»¬', 'å…³æ³¨è·å–æ›´æ–°'],
    tiktok: ['åŒå‡»å°å¿ƒå¿ƒ', 'å…³æ³¨ä¸è¿·è·¯', 'è¯„è®ºåŒºè®¨è®º'],
    youtube: ['ç‚¹èµè®¢é˜…', 'è¯„è®ºäº’åŠ¨', 'å¼€å¯å°é“ƒé“›']
  }
  
  const platformCTAs = ctas[platform] || ctas.facebook
  const randomCTA = platformCTAs[Math.floor(Math.random() * platformCTAs.length)]
  
  return content + ` ${randomCTA}ï¼`
}

// æ·»åŠ é—®é¢˜äº’åŠ¨
const addQuestion = (content, platform) => {
  const questions = [
    'ä½ ä»¬è§‰å¾—å‘¢ï¼Ÿ',
    'æœ‰åŒæ„Ÿçš„å—ï¼Ÿ',
    'ä½ ä¼šé€‰æ‹©å“ªä¸ªï¼Ÿ',
    'è¯„è®ºåŒºèŠèŠå§ï¼',
    'å¤§å®¶æ€ä¹ˆçœ‹ï¼Ÿ'
  ]
  
  const randomQuestion = questions[Math.floor(Math.random() * questions.length)]
  return content + ` ${randomQuestion}`
}

// ç”Ÿæˆæ ‡ç­¾
const generateHashtags = (platform) => {
  const baseHashtags = formData.hashtags ? formData.hashtags.split(',').map(h => h.trim()) : []
  const contentTypeHashtags = {
    'product-promotion': ['äº§å“æ¨è', 'æ–°å“ä¸Šå¸‚', 'é™æ—¶ä¼˜æƒ '],
    'brand-awareness': ['å“ç‰Œæ•…äº‹', 'ä¼ä¸šæ–‡åŒ–', 'ä»·å€¼ç†å¿µ'],
    'event-promotion': ['æ´»åŠ¨é¢„å‘Š', 'æŠ¥åå‚ä¸', 'é™æ—¶æ´»åŠ¨'],
    'education': ['å¹²è´§åˆ†äº«', 'çŸ¥è¯†æ™®åŠ', 'æŠ€èƒ½æå‡'],
    'customer-story': ['ç”¨æˆ·åˆ†äº«', 'æˆåŠŸæ¡ˆä¾‹', 'çœŸå®ä½“éªŒ'],
    'industry-news': ['è¡Œä¸šèµ„è®¯', 'è¶‹åŠ¿åˆ†æ', 'ä¸“ä¸šè§£è¯»']
  }
  
  const typeHashtags = contentTypeHashtags[formData.contentType] || []
  const platformHashtags = {
    twitter: ['çƒ­é—¨è¯é¢˜', 'å®æ—¶æ›´æ–°'],
    instagram: ['ç¾å›¾åˆ†äº«', 'ç”Ÿæ´»æ–¹å¼'],
    facebook: ['ç¤¾åŒºäº’åŠ¨', 'æœ‹å‹åˆ†äº«'],
    linkedin: ['èŒåœºåˆ†äº«', 'ä¸“ä¸šè§è§£'],
    tiktok: ['åˆ›æ„å†…å®¹', 'çƒ­é—¨æŒ‘æˆ˜'],
    youtube: ['è§†é¢‘æ¨è', 'è®¢é˜…å…³æ³¨']
  }
  
  const allHashtags = [...baseHashtags, ...typeHashtags, ...(platformHashtags[platform] || [])]
  
  // éšæœºé€‰æ‹©3-5ä¸ªæ ‡ç­¾
  const selectedCount = Math.min(allHashtags.length, Math.floor(Math.random() * 3) + 3)
  return allHashtags.slice(0, selectedCount)
}

// è·å–é¢å¤–å†…å®¹
const getAdditionalContent = (platform, contentType) => {
  const additions = {
    'product-promotion': 'äº§å“ç»è¿‡ä¸¥æ ¼æµ‹è¯•ï¼Œå“è´¨æœ‰ä¿éšœï¼Œç°åœ¨è´­ä¹°è¿˜æœ‰ä¸“å±ä¼˜æƒ ï¼',
    'brand-awareness': 'æˆ‘ä»¬è‡´åŠ›äºä¸ºç”¨æˆ·æä¾›æœ€ä¼˜è´¨çš„æœåŠ¡ä½“éªŒï¼ŒæœŸå¾…ä¸æ‚¨ä¸€åŒæˆé•¿ï¼',
    'event-promotion': 'æ´»åŠ¨åé¢æœ‰é™ï¼Œå…ˆåˆ°å…ˆå¾—ï¼Œä¸è¦é”™è¿‡è¿™ä¸ªéš¾å¾—çš„æœºä¼šï¼'
  }
  
  return additions[contentType] || 'æ¬¢è¿å…³æ³¨æˆ‘ä»¬ï¼Œè·å–æ›´å¤šç²¾å½©å†…å®¹ï¼'
}

// è·å–å¹³å°ç»“æœ
const getPlatformResults = (platform) => {
  return generatedResults.value.filter(result => result.platform === platform)
}

// è·å–å¹³å°æ ‡ç­¾
const getPlatformLabel = (platform) => {
  const labels = {
    facebook: 'Facebook',
    instagram: 'Instagram',
    twitter: 'Twitter/X',
    linkedin: 'LinkedIn',
    tiktok: 'TikTok',
    youtube: 'YouTube'
  }
  return labels[platform] || platform
}

// è·å–å¹³å°é™åˆ¶
const getPlatformLimit = (platform) => {
  const limits = {
    twitter: 280,
    instagram: 2200,
    facebook: 2000,
    linkedin: 1300,
    tiktok: 150,
    youtube: 5000
  }
  return limits[platform] || 500
}

// è·å–é•¿åº¦ç±»å‹
const getLengthType = (length, platform) => {
  const limit = getPlatformLimit(platform)
  if (length < limit * 0.5) return 'success'
  if (length < limit * 0.8) return 'warning'
  return 'danger'
}

// è·å–å¹³å‡é•¿åº¦
const getAverageLength = (platform) => {
  const results = getPlatformResults(platform)
  if (results.length === 0) return 0
  const total = results.reduce((sum, result) => sum + result.length, 0)
  return Math.round(total / results.length)
}

// è·å–å¹³å‡è¯„åˆ†
const getAverageRating = (platform) => {
  const results = getPlatformResults(platform)
  if (results.length === 0) return 0
  const total = results.reduce((sum, result) => sum + result.rating, 0)
  return Math.round((total / results.length) * 10) / 10
}

// æ·»åŠ æ ‡ç­¾
const addHashtag = (tag) => {
  const currentTags = formData.hashtags ? formData.hashtags.split(',').map(h => h.trim()) : []
  if (!currentTags.includes(tag)) {
    formData.hashtags = currentTags.concat(tag).join(', ')
  }
}

// å¤åˆ¶å†…å®¹
const copyContent = async (text) => {
  try {
    await navigator.clipboard.writeText(text)
    ElMessage.success('å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿')
  } catch (error) {
    ElMessage.error('å¤åˆ¶å¤±è´¥')
  }
}

// ç¼–è¾‘å†…å®¹
const editContent = (platform, index) => {
  const result = getPlatformResults(platform)[index]
  editForm.platform = platform
  editForm.index = index
  editForm.text = result.text
  editForm.hashtagsText = result.hashtags ? result.hashtags.join(', ') : ''
  editDialogVisible.value = true
}

// ä¿å­˜ç¼–è¾‘
const saveEdit = () => {
  const results = getPlatformResults(editForm.platform)
  const result = results[editForm.index]
  
  result.text = editForm.text
  result.length = editForm.text.length
  result.hashtags = editForm.hashtagsText ? 
    editForm.hashtagsText.split(',').map(h => h.trim()) : []
  
  editDialogVisible.value = false
  ElMessage.success('ç¼–è¾‘ä¿å­˜æˆåŠŸ')
}

// åˆ†äº«å†…å®¹
const shareContent = (content) => {
  ElMessage.info('åˆ†äº«åŠŸèƒ½å¼€å‘ä¸­...')
}

// å‘å¸ƒå†…å®¹
const publishContent = async (platform, content) => {
  try {
    await ElMessageBox.confirm(
      `ç¡®å®šè¦å°†æ­¤å†…å®¹å‘å¸ƒåˆ°${getPlatformLabel(platform)}å—ï¼Ÿ`,
      'ç¡®è®¤å‘å¸ƒ',
      {
        confirmButtonText: 'ç¡®å®šå‘å¸ƒ',
        cancelButtonText: 'å–æ¶ˆ',
        type: 'info'
      }
    )
    
    // æ¨¡æ‹Ÿå‘å¸ƒè¿‡ç¨‹
    ElMessage.success(`å†…å®¹å·²æˆåŠŸå‘å¸ƒåˆ°${getPlatformLabel(platform)}ï¼`)
  } catch {
    // ç”¨æˆ·å–æ¶ˆ
  }
}

// æ›´æ–°è¯„åˆ†
const updateRating = (platform, index, rating) => {
  const results = getPlatformResults(platform)
  results[index].rating = rating
}

// å¯¼å‡ºå…¨éƒ¨
const exportAll = () => {
  const data = generatedResults.value.map(result => ({
    å¹³å°: getPlatformLabel(result.platform),
    å†…å®¹: result.text,
    å­—æ•°: result.length,
    æ ‡ç­¾: result.hashtags ? result.hashtags.join(', ') : '',
    è¯„åˆ†: result.rating
  }))
  
  const csv = convertToCSV(data)
  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' })
  const link = document.createElement('a')
  const url = URL.createObjectURL(blob)
  link.setAttribute('href', url)
  link.setAttribute('download', `ç¤¾åª’è¯æœ¯_${new Date().toISOString().split('T')[0]}.csv`)
  link.click()
  URL.revokeObjectURL(url)
  
  ElMessage.success('å¯¼å‡ºæˆåŠŸ')
}

// è½¬æ¢ä¸ºCSV
const convertToCSV = (data) => {
  if (!data.length) return ''
  
  const headers = Object.keys(data[0])
  const csvContent = [
    headers.join(','),
    ...data.map(row => headers.map(header => `"${row[header]}"`).join(','))
  ].join('\n')
  
  return '\uFEFF' + csvContent // æ·»åŠ BOMä»¥æ”¯æŒä¸­æ–‡
}

// æ¸…ç©ºç»“æœ
const clearResults = () => {
  generatedResults.value = []
  activePlatform.value = ''
  ElMessage.success('ç»“æœå·²æ¸…ç©º')
}
</script>

<style lang="scss" scoped>
.social-content-page {
  padding: 20px;
  background-color: #f5f7fa;
}

.page-header {
  margin-bottom: 24px;
  
  h1 {
    font-size: 28px;
    font-weight: 600;
    color: #303133;
    margin: 0 0 8px 0;
  }
  
  .page-desc {
    color: #606266;
    font-size: 14px;
    margin: 0;
  }
}

.card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  
  span {
    font-weight: 600;
    color: #303133;
  }
}

.config-panel {
  height: fit-content;
  
  .platform-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
    
    .platform-item {
      border: 1px solid #dcdfe6;
      border-radius: 8px;
      padding: 12px;
      transition: all 0.3s;
      
      &:hover {
        border-color: #409eff;
      }
      
      .platform-content {
        display: flex;
        align-items: center;
        gap: 8px;
        
        .platform-icon {
          font-size: 20px;
          
          &.facebook { color: #1877f2; }
          &.instagram { color: #e4405f; }
          &.twitter { color: #1da1f2; }
          &.linkedin { color: #0077b5; }
          &.tiktok { color: #ff0050; }
          &.youtube { color: #ff0000; }
        }
      }
    }
  }
  
  .length-settings {
    .custom-length {
      margin-top: 16px;
      
      .length-hint {
        margin: 8px 0 0 0;
        font-size: 12px;
        color: #909399;
      }
    }
  }
  
  .hashtag-suggestions {
    margin-top: 8px;
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    
    .suggestion-tag {
      cursor: pointer;
      transition: all 0.3s;
      
      &:hover {
        background-color: #409eff;
        color: white;
      }
    }
  }
  
  .usage-stats {
    margin-top: 24px;
    padding: 16px;
    background-color: #f8f9fa;
    border-radius: 8px;
    
    .stats-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
  }
}

.results-panel {
  min-height: 600px;
}

.loading-container {
  text-align: center;
  padding: 40px 20px;
  
  .loading-text {
    margin: 20px 0;
    color: #606266;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    
    .rotating {
      animation: rotate 1s linear infinite;
    }
  }
}

@keyframes rotate {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

.results-container {
  .platform-overview {
    margin-bottom: 24px;
    padding: 20px;
    background-color: #f8f9fa;
    border-radius: 8px;
    
    .quality-score {
      display: flex;
      align-items: center;
      gap: 8px;
      
      .score-label {
        font-size: 14px;
        color: #606266;
      }
    }
  }
  
  .content-list {
    display: flex;
    flex-direction: column;
    gap: 16px;
  }
  
  .content-item {
    border: 1px solid #e4e7ed;
    border-radius: 12px;
    padding: 20px;
    background-color: white;
    transition: all 0.3s;
    
    &:hover {
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .content-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      
      .content-meta {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }
    }
    
    .content-body {
      margin-bottom: 16px;
      
      .content-text {
        line-height: 1.6;
        color: #303133;
        font-size: 15px;
        margin-bottom: 12px;
      }
      
      .content-hashtags {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        
        .hashtag-item {
          font-size: 12px;
        }
      }
    }
    
    .content-footer {
      display: flex;
      justify-content: flex-end;
    }
  }
}

.empty-state {
  text-align: center;
  padding: 60px 20px;
  
  .empty-icon {
    font-size: 48px;
    color: #c0c4cc;
    margin-bottom: 16px;
  }
  
  p {
    color: #909399;
    margin: 16px 0 0 0;
  }
}

@media (max-width: 768px) {
  .social-content-page {
    padding: 12px;
  }
  
  .el-row {
    margin: 0 !important;
  }
  
  .el-col {
    padding: 0 !important;
    
    &:first-child {
      margin-bottom: 20px;
    }
  }
  
  .platform-grid {
    grid-template-columns: 1fr !important;
  }
  
  .content-footer {
    .el-button-group {
      flex-wrap: wrap;
      gap: 8px;
    }
  }
}
</style>